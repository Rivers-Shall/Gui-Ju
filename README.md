# gui-ju

A Clojure library designed to test linearizability of CAS(Compare-And-Swap) history (with read mapping) generated by [Jepsen](https://jepsen.io/).

## Usage

Currently, this is a standalone app which takes history file and outputs test result.

We may integrate this app into Jepsen someday. For an integrated linearizability test library, you may consider [Knossos](https://github.com/jepsen-io/knossos).

Also, checking linearizability of CAS history is hard. [Knossos](https://github.com/jepsen-io/knossos) uses an algorithm
which runs in exponential time. Gui-Ju, on the other hand, runs in quadratic time.
But lower time complexity comes with a cost
-- We need read mapping, i.e., we need to know which operation any read result belongs to. It is not possible for jepsen
or any test framework to provide such information. So we upgrade our constraints -- we need:

1. One and only one write operation to initialize data.
2. Every successful CAS operation writes unique value,
which results in the fact that every successful CAS operation should also
read unique value.

Our algorithm checks the constrains above. (More information about linearizability with read mapping can be found in
*Testing Shared Memories* by Phillip B. Gibbons and Ephraim Korach.)

Moreover, the history file you provide should be history on
an independent data, like `resources/test-history/example.edn`. (Note that this is a
valid input for our app, but it is not a valid history for linearizability with read mapping.)
And just run the app like

```text
lein run <path-to-history-edn-file>
```

The result will show on `stdout`.

### Result Explained

Our result have two parts in the form

```clojure
{
    :valid? <valid-status>,
    :evidence <evidence-for-status>
}
```

`:valid?` have 7 possible values:

- `:invalid-rm-repeated-read`
  - shows two operations read the same value with `:evidence` being those two operations.
- `:invalid-rm-repeated-write`
  - shows two operations write the same value with `:evidence` being those two operations.
- `:invalid-rm-not-one-write`
  - shows the history has none or more than one write operation with `:evidence` being all write operations.
- `:invalid-value-no-first-cas`
  - shows that no successful CAS operation reads the value written by the initial write operation with `:evidence` being an empty list.
- `:invalid-value-incomplete-cas-chain`
  - shows that all successful CAS operations cannot form a valid value chain (i.e. a sequence where every CAS reads the value written by previous CAS) with `:evidence` being the longest sequence that can be found.
- `:invalid-time-conflict`
  - shows that two operations in value-chain cannot be properly arranged in time because the latter one ends before the previous one starts, with `:evidence` being those two conflicting operations.
- `:valid`
  - shows that the history is valid for linearizability with `:evidence` being an empty list.

All the results above have a corresponding test file in `resources/test-history`. You may run the app on those tests for better understanding.

## License

Copyright Â© 2022 FIXME

This program and the accompanying materials are made available under the
terms of the Eclipse Public License 2.0 which is available at
<http://www.eclipse.org/legal/epl-2.0>.

This Source Code may also be made available under the following Secondary
Licenses when the conditions for such availability set forth in the Eclipse
Public License, v. 2.0 are satisfied: GNU General Public License as published by
the Free Software Foundation, either version 2 of the License, or (at your
option) any later version, with the GNU Classpath Exception which is available
at <https://www.gnu.org/software/classpath/license.html>.
